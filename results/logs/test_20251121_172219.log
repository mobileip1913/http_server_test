2025-11-21 17:22:19 | INFO     | ✅ 已从项目目录加载 Opus DLL: D:\code\http_server\libs\opus.dll
2025-11-21 17:23:24 | INFO     | Connection #1: ========== AUTH REQUEST ==========
2025-11-21 17:23:24 | INFO     | Connection #1: Request URL: ws://toyaiws.spacechaintech.com:8081/?sn=FC012C2EA080&sign=bf4a0b6fb38f351a59583f97352dc6c4&platform=hw&bid=TKAI_BOARD_03_4G_VB6824_EYE_ST7789&fv=0.0.1&fvc=20250908001&strategy_id=0&uid=0&board_type=ml307&recover=0&enableP3=2&tool=idf&screen=1
2025-11-21 17:23:24 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:24 | INFO     | Connection #1: Request Headers:
2025-11-21 17:23:24 | INFO     | Connection #1:   Protocol-Version: 1
2025-11-21 17:23:24 | INFO     | Connection #1:   Device-Id: FC:01:2C:2E:A0:80
2025-11-21 17:23:24 | INFO     | Connection #1: ==================================
2025-11-21 17:23:24 | INFO     | [CONNECTION] Connection #1 | Status: success | Duration: 160.45ms
2025-11-21 17:23:25 | INFO     | Connection #1: ========== AUTH RESPONSE ==========
2025-11-21 17:23:25 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:25 | INFO     | Connection #1: Response Code: 0
2025-11-21 17:23:25 | INFO     | Connection #1: Response Message: auth_success
2025-11-21 17:23:25 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:25 | INFO     | Connection #1: {
  "type": "auth",
  "code": 0,
  "msg": "auth_success",
  "data": {
    "sn": "FC012C2EA080",
    "volume": 70,
    "light": 20,
    "time": 1763717006268,
    "can_use_while_charging": 1
  }
}
2025-11-21 17:23:25 | INFO     | Connection #1: Session ID: None
2025-11-21 17:23:25 | INFO     | Connection #1: ====================================
2025-11-21 17:23:25 | INFO     | Connection #1: ✅ Auth SUCCESS | Code: 0, Message: auth_success, Session ID: None
2025-11-21 17:23:25 | INFO     | 
============================================================
2025-11-21 17:23:25 | INFO     | Testing [SINGLE] #001: 下单牛肉...
2025-11-21 17:23:25 | INFO     | Audio file: temp_audio.opus
2025-11-21 17:23:25 | INFO     | ============================================================
2025-11-21 17:23:25 | INFO     | Connection #1: Loading audio file: C:\Users\mobil\AppData\Local\Temp\tts_test_hjbuwj19\temp_audio.opus
2025-11-21 17:23:25 | INFO     | Detected Ogg Opus container, converting with ffmpeg...
2025-11-21 17:23:25 | INFO     | Converting Ogg Opus to PCM and re-encoding to raw Opus packets...
2025-11-21 17:23:25 | INFO     | Processed remaining 1200 bytes PCM data with 720 bytes padding (total 31920 bytes)
2025-11-21 17:23:25 | INFO     | Generated 17 raw Opus packets from PCM data (total 3664 bytes, processed 31920 bytes PCM, coverage: 97.8%)
2025-11-21 17:23:25 | INFO     | Detected 17 raw Opus packets from Ogg container. These MUST be sent individually (one per WebSocket message), ignoring SPLIT_OPUS_PACKETS=False
2025-11-21 17:23:25 | INFO     | Connection #1: Successfully loaded 17 audio frames from C:\Users\mobil\AppData\Local\Temp\tts_test_hjbuwj19\temp_audio.opus
2025-11-21 17:23:25 | INFO     | Connection #1: ========== SEND START_LISTEN ==========
2025-11-21 17:23:25 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:25 | INFO     | Connection #1: WebSocket URL: ws://toyaiws.spacechaintech.com:8081/?sn=FC012C2EA080&sign=bf4a0b6fb38f351a59583f97352dc6c4&platform=hw&bid=TKAI_BOARD_03_4G_VB6824_EYE_ST7789&fv=0.0.1&fvc=20250908001&strategy_id=0&uid=0&board_type=ml307&recover=0&enableP3=2&tool=idf&screen=1
2025-11-21 17:23:25 | INFO     | Connection #1: Session ID: None
2025-11-21 17:23:25 | INFO     | Connection #1: Message Content:
2025-11-21 17:23:25 | INFO     | Connection #1: {
  "session_id": "",
  "type": "start_listen",
  "data": {
    "format": "opus",
    "tts_format": "opus",
    "playTag": 1,
    "state": "asr",
    "mode": "manual"
  }
}
2025-11-21 17:23:25 | INFO     | Connection #1: Message Size: 140 bytes
2025-11-21 17:23:25 | INFO     | Connection #1: =======================================
2025-11-21 17:23:25 | INFO     | Connection #1: Preparing to send 17 audio frames
2025-11-21 17:23:27 | INFO     | Connection #1: ========== STT RESPONSE ==========
2025-11-21 17:23:27 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:27 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:27 | INFO     | Connection #1: {
  "type": "stt",
  "text": "下单牛肉。"
}
2025-11-21 17:23:27 | INFO     | Connection #1: Response Time: 1271.07ms (from send_start)
2025-11-21 17:23:27 | INFO     | Connection #1: Recognized Text: 下单牛肉。
2025-11-21 17:23:27 | INFO     | Connection #1: =================================
2025-11-21 17:23:27 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:27 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:27 | INFO     | Connection #1: State: start
2025-11-21 17:23:27 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:27 | INFO     | Connection #1: {
  "type": "tts",
  "state": "start"
}
2025-11-21 17:23:27 | INFO     | Connection #1: TTS Start Time
2025-11-21 17:23:27 | INFO     | Connection #1: =================================
2025-11-21 17:23:29 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:29 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:29 | INFO     | Connection #1: State: sentence_start
2025-11-21 17:23:29 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:29 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_start",
  "text": "马上帮你处理订单，稍作等待哦"
}
2025-11-21 17:23:29 | INFO     | Connection #1: TTS Sentence Start | Text: 马上帮你处理订单，稍作等待哦
2025-11-21 17:23:29 | INFO     | Connection #1: =================================
2025-11-21 17:23:32 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:32 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:32 | INFO     | Connection #1: State: sentence_end
2025-11-21 17:23:32 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:32 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_end",
  "text": ""
}
2025-11-21 17:23:32 | INFO     | Connection #1: TTS Sentence End
2025-11-21 17:23:32 | INFO     | Connection #1: =================================
2025-11-21 17:23:32 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:32 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:32 | INFO     | Connection #1: State: sentence_start
2025-11-21 17:23:32 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:32 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_start",
  "text": "好呀，已经成功帮你下单啦！"
}
2025-11-21 17:23:32 | INFO     | Connection #1: TTS Sentence Start | Text: 好呀，已经成功帮你下单啦！
2025-11-21 17:23:32 | INFO     | Connection #1: =================================
2025-11-21 17:23:34 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:34 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:34 | INFO     | Connection #1: State: sentence_end
2025-11-21 17:23:34 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:34 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_end",
  "text": ""
}
2025-11-21 17:23:34 | INFO     | Connection #1: TTS Sentence End
2025-11-21 17:23:34 | INFO     | Connection #1: =================================
2025-11-21 17:23:34 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:34 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:34 | INFO     | Connection #1: State: sentence_start
2025-11-21 17:23:34 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:34 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_start",
  "text": "\n商品名称：牛肉面 \n商品类型：看这信息推测应该是食品类 \n价格：0.0元 \n数量：1份\n订单详情：订单号是ORDER-9817 "
}
2025-11-21 17:23:34 | INFO     | Connection #1: TTS Sentence Start | Text: 
商品名称：牛肉面 
商品类型：看这信息推测应该是食品类 
价格：0.0元 
数量：1份
订单详情：订单号是ORDER-9817 
2025-11-21 17:23:34 | INFO     | Connection #1: =================================
2025-11-21 17:23:49 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:49 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:49 | INFO     | Connection #1: State: sentence_end
2025-11-21 17:23:49 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:49 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_end",
  "text": ""
}
2025-11-21 17:23:49 | INFO     | Connection #1: TTS Sentence End
2025-11-21 17:23:49 | INFO     | Connection #1: =================================
2025-11-21 17:23:49 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:49 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:49 | INFO     | Connection #1: State: sentence_start
2025-11-21 17:23:49 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:49 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_start",
  "text": "，商品描述就是“牛肉面 ”，订单状态是“created”。"
}
2025-11-21 17:23:49 | INFO     | Connection #1: TTS Sentence Start | Text: ，商品描述就是“牛肉面 ”，订单状态是“created”。
2025-11-21 17:23:49 | INFO     | Connection #1: =================================
2025-11-21 17:23:54 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:54 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:54 | INFO     | Connection #1: State: sentence_end
2025-11-21 17:23:54 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:54 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_end",
  "text": ""
}
2025-11-21 17:23:54 | INFO     | Connection #1: TTS Sentence End
2025-11-21 17:23:54 | INFO     | Connection #1: =================================
2025-11-21 17:23:54 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:54 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:54 | INFO     | Connection #1: State: sentence_start
2025-11-21 17:23:54 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:54 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_start",
  "text": "目前已成功创建订单，请你打开链芯智萌小程序查看。  "
}
2025-11-21 17:23:54 | INFO     | Connection #1: TTS Sentence Start | Text: 目前已成功创建订单，请你打开链芯智萌小程序查看。  
2025-11-21 17:23:54 | INFO     | Connection #1: =================================
2025-11-21 17:23:59 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:59 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:59 | INFO     | Connection #1: State: sentence_end
2025-11-21 17:23:59 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:59 | INFO     | Connection #1: {
  "type": "tts",
  "state": "sentence_end",
  "text": ""
}
2025-11-21 17:23:59 | INFO     | Connection #1: TTS Sentence End
2025-11-21 17:23:59 | INFO     | Connection #1: =================================
2025-11-21 17:23:59 | INFO     | Connection #1: ========== TTS RESPONSE ==========
2025-11-21 17:23:59 | INFO     | Connection #1: Device SN: FC012C2EA080
2025-11-21 17:23:59 | INFO     | Connection #1: State: stop
2025-11-21 17:23:59 | INFO     | Connection #1: Full Response Data:
2025-11-21 17:23:59 | INFO     | Connection #1: {
  "type": "tts",
  "state": "stop"
}
2025-11-21 17:23:59 | INFO     | Connection #1: TTS Stop Time | Duration: 32695.46ms
2025-11-21 17:23:59 | INFO     | Connection #1: =================================
2025-11-21 17:23:59 | INFO     | Connection #1: Received complete response at 30.2s
2025-11-21 17:23:59 | INFO     | ✓ Response received: [STT] 下单牛肉。 | [LLM] 马上帮你处理订单，稍作等待哦 好呀，已经成功帮你下单啦！ 商品名称：牛肉面 
商品类型：看这信息推测应该是食品类 
价格：0.0元 
数量：1份
订单详情：订单...
